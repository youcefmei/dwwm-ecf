{% extends 'base.html.twig' %}

{% set searching = app.request.query.get("s") %}
{% set filters = app.request.query.get("filter") %}
{% set current_path = app.request.get('_route') %}

{% block title %}Eco IT | Formations{% endblock %}

{% block body %}

<main>

    <h1 class="text-center mt-5 fs-3">{{mainTitle}}</h1>
    <div class="container  mt-5 px-5">
        <div class="row">
            <div class="col">
                <div class="input-group input-group-lg">
                    <span class="input-group-text">Chercher une formation</span>
                    <input type="text" class="form-control" aria-label="Chercher une formation" placeholder="..."
                        aria-describedby="search-courses" id="search-courses">
                </div>
            </div>
        </div>
    </div>

    {% include "course/_courses.html.twig" %}
    <script defer>
        let courseBlock = document.getElementById("courses")
        let searchCourse = document.getElementById("search-courses")
        var previousUrl = window.location.href //.split("/").slice(0, 5).join("/")
        searchCourse.addEventListener("input", (e) => {
            var url = new URL(previousUrl)
            const urlSearchParams = new URLSearchParams(window.location.search);
            urlSearchParams.set("s", searchCourse.value)
            url.search = urlSearchParams.toString()
            console.log(url)
            fetch(url).then((response) => {
                if (response.status !== 200) {
                    console.log(
                        "Looks like there was a problem. Status Code: " + response.status
                    )
                    return
                }
                return response.text()
            })
                .then((res) => {
                    while (courseBlock.firstChild) {
                        courseBlock.removeChild(courseBlock.firstChild)
                    }
                    let template = document.createElement("template")
                    html = res.trim()
                    template.innerHTML = html
                    //   console.log(html)
                    courseBlock.appendChild(template.content.firstChild)
                            })
        })

    </script>
</main>
{% endblock %}